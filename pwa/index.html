<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PosturePal - AI Posture Monitor</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/calibration.css">

    <!-- MediaPipe dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
        crossorigin="anonymous"></script>
</head>

<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <h1 class="logo">PosturePal</h1>
            <div class="header-controls">
                <div class="status-indicator" id="status-indicator">
                    <span class="status-dot"></span>
                    <span id="status-text">Inactive</span>
                </div>
                <button id="settings-btn" class="btn-icon">‚öôÔ∏è</button>
            </div>
        </header>

        <!-- Main Content -->
        <main id="reading-container" class="reading-container">
            <div class="info-grid">
                <!-- Left Column: About -->
                <div class="info-section">
                    <h2>ü¶í About PosturePal</h2>
                    <p>
                        <strong>Your AI-powered posture companion</strong> that helps you maintain healthy neck and
                        shoulder alignment while working on your computer.
                    </p>
                    <p>
                        Using advanced computer vision, PosturePal monitors your posture in real-time
                        and alerts you when you:
                    </p>
                    <ul>
                        <li><strong>üê¢ Slouch</strong> - Forward head posture</li>
                        <li><strong>üìê Tilt</strong> - Lateral neck bending</li>
                        <li><strong>üí™ Shrug</strong> - Raised shoulders</li>
                    </ul>
                    <p>
                        <strong>100% Private:</strong> All processing happens locally in your browser. No data is ever
                        sent to servers.
                    </p>
                    <p>
                        <strong>Picture-in-Picture Mode:</strong> Pop out a floating widget that stays on top of all
                        your apps.
                    </p>
                </div>

                <!-- Right Column: How to Use -->
                <div class="info-section">
                    <h2>üöÄ How to Use</h2>
                    <ol class="how-to-list">
                        <li>
                            <strong>Calibrate (Recommended)</strong><br>
                            Click Settings ‚Üí "Start Calibration Wizard" to personalize detection for your physique and
                            camera angle. Takes ~30 seconds.
                        </li>
                        <li>
                            <strong>Activate Guard</strong><br>
                            Click the "üõ°Ô∏è Activate" button and allow camera permissions.
                        </li>
                        <li>
                            <strong>Pop Out Widget (Optional)</strong><br>
                            Click "‚ÜóÔ∏è" to launch a floating window that stays on top of all apps.
                        </li>
                        <li>
                            <strong>Work Normally</strong><br>
                            The emoji avatar changes based on your posture:
                            <ul style="margin-top: 8px;">
                                <li>ü¶í Great Posture</li>
                                <li>üê¢ Slouching</li>
                                <li>üìê Tilting</li>
                                <li>üí™ Shrugging</li>
                                <li>üò¥ Away/Idle</li>
                            </ul>
                        </li>
                    </ol>

                    <div class="settings-info">
                        <h3>‚öôÔ∏è Settings</h3>
                        <ul>
                            <li><strong>Sensitivity:</strong> Adjust detection threshold</li>
                            <li><strong>Timer:</strong> How long before alert triggers</li>
                            <li><strong>Calibration:</strong> Personalize to your body</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>

        <!-- Controls / Floating Action Button -->
        <div class="controls">
            <button id="toggle-guard-btn" class="btn-fab">
                üõ°Ô∏è Activate
            </button>
            <button id="pip-btn" class="btn-fab secondary hidden" title="Pop Out Widget">
                ‚ÜóÔ∏è
            </button>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button id="close-settings" class="btn-text">‚úï</button>
                </div>

                <div class="setting-group">
                    <h3>Calibration</h3>
                    <p class="setting-desc">Sit up straight with phone at eye level.</p>
                    <button id="calibrate-btn" class="btn-secondary">Set Healthy Posture (Zero)</button>
                    <p id="calibration-status" class="status-small">Default</p>
                </div>

                <div class="setting-group">
                    <h3>Time Limit</h3>
                    <div class="range-wrap">
                        <label for="timer-slider">Delay</label>
                        <input type="range" id="timer-slider" min="2" max="120" step="1" value="5">
                        <span id="timer-val">5s</span>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>Sensitivity</h3>
                    <div class="range-wrap">
                        <label for="sensitivity-slider">Tolerance</label>
                        <input type="range" id="sensitivity-slider" min="0.5" max="1.5" step="0.05" value="0.85">
                        <span id="sensitivity-val">0.85</span>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>Content</h3>
                    <textarea id="custom-text-input" placeholder="Paste your article or book text here..."
                        rows="4"></textarea>
                    <button id="load-text-btn" class="btn-primary small">Load Text</button>
                </div>

                <div class="setting-group">
                    <h3>Debug</h3>
                    <button id="toggle-debug-btn" class="btn-text small">Toggle Camera View</button>
                </div>
            </div>
        </div>

        <!-- Calibration Wizard Modal -->
        <div id="calibration-modal" class="calibration-modal hidden">
            <div class="calibration-content">
                <div class="calibration-header">
                    <h2>Posture Calibration Wizard</h2>
                    <div class="calibration-progress">
                        <div class="progress-dot" data-step="0"></div>
                        <div class="progress-dot" data-step="1"></div>
                        <div class="progress-dot" data-step="2"></div>
                        <div class="progress-dot" data-step="3"></div>
                        <div class="progress-dot" data-step="4"></div>
                        <div class="progress-dot" data-step="5"></div>
                    </div>
                </div>

                <!-- Step 0: Welcome -->
                <div class="calibration-step active" data-step="0">
                    <div class="step-instruction">
                        <h3>Welcome! üëã</h3>
                        <p>This wizard will personalize Text Neck Guard to your unique physique and camera setup.</p>
                        <p style="margin-top: 10px;">You'll be asked to demonstrate different postures. The process
                            takes about 2-3 minutes.</p>
                    </div>
                    <div class="calibration-actions">
                        <button class="btn-calibrate secondary" id="cal-cancel">Cancel</button>
                        <button class="btn-calibrate primary" id="cal-start">Start Calibration</button>
                    </div>
                </div>

                <!-- Step 1: Good Posture -->
                <div class="calibration-step" data-step="1">
                    <div class="step-instruction">
                        <h3>Step 1: Good Posture ü¶í</h3>
                        <p>Sit up straight with your phone/screen at eye level. Keep your shoulders relaxed and head
                            aligned with your spine.</p>
                    </div>
                    <div class="sample-indicator">
                        <span class="sample-emoji">ü¶í</span>
                        <div class="sample-count">Collecting samples: <span id="cal-good-count">0</span>/3</div>
                        <div class="sample-progress-bar">
                            <div class="sample-progress-fill" id="cal-good-progress"></div>
                        </div>
                    </div>
                    <div class="calibration-actions">
                        <button class="btn-calibrate primary" id="cal-collect-good">Hold This Posture</button>
                    </div>
                </div>

                <!-- Step 2: Slouch -->
                <div class="calibration-step" data-step="2">
                    <div class="step-instruction">
                        <h3>Step 2: Slouching üê¢</h3>
                        <p>Lean forward and look down at your device. This is the "text neck" posture we want to detect.
                        </p>
                    </div>
                    <div class="sample-indicator">
                        <span class="sample-emoji">üê¢</span>
                        <div class="sample-count">Collecting samples: <span id="cal-slouch-count">0</span>/3</div>
                        <div class="sample-progress-bar">
                            <div class="sample-progress-fill" id="cal-slouch-progress"></div>
                        </div>
                    </div>
                    <div class="calibration-actions">
                        <button class="btn-calibrate primary" id="cal-collect-slouch">Hold This Posture</button>
                    </div>
                </div>

                <!-- Step 3: Tilt -->
                <div class="calibration-step" data-step="3">
                    <div class="step-instruction">
                        <h3>Step 3: Head Tilt üìê</h3>
                        <p>Tilt your head to the left or right (like resting it on your shoulder). We'll detect lateral
                            neck bending.</p>
                    </div>
                    <div class="sample-indicator">
                        <span class="sample-emoji">üìê</span>
                        <div class="sample-count">Collecting samples: <span id="cal-tilt-count">0</span>/3</div>
                        <div class="sample-progress-bar">
                            <div class="sample-progress-fill" id="cal-tilt-progress"></div>
                        </div>
                    </div>
                    <div class="calibration-actions">
                        <button class="btn-calibrate primary" id="cal-collect-tilt">Hold This Posture</button>
                    </div>
                </div>

                <!-- Step 4: Shrug -->
                <div class="calibration-step" data-step="4">
                    <div class="step-instruction">
                        <h3>Step 4: Shoulder Shrug üí™</h3>
                        <p>Raise your shoulders up toward your ears (like shrugging). Hold this position while we
                            collect samples.</p>
                    </div>
                    <div class="sample-indicator">
                        <span class="sample-emoji">üí™</span>
                        <div class="sample-count">Collecting samples: <span id="cal-shrug-count">0</span>/3</div>
                        <div class="sample-progress-bar">
                            <div class="sample-progress-fill" id="cal-shrug-progress"></div>
                        </div>
                    </div>
                    <div class="calibration-actions">
                        <button class="btn-calibrate primary" id="cal-collect-shrug">Hold This Posture</button>
                    </div>
                </div>

                <!-- Step 5: Summary -->
                <div class="calibration-step" data-step="5">
                    <div class="step-instruction">
                        <h3>Calibration Complete! ‚úÖ</h3>
                        <p>Your personalized thresholds have been calculated based on your samples.</p>
                    </div>
                    <div class="calibration-summary" id="cal-summary">
                        <!-- Summary will be populated by JS -->
                    </div>
                    <div class="calibration-actions">
                        <button class="btn-calibrate secondary" id="cal-recalibrate">Recalibrate</button>
                        <button class="btn-calibrate primary" id="cal-finish">Finish</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden Camera Feed for Debug/Setup -->
        <div id="camera-preview" class="camera-preview hidden">
            <video id="input-video" playsinline muted></video>
            <canvas id="output-canvas"></canvas>
            <div class="close-preview" id="close-preview">‚úï</div>
            <div class="debug-info" id="debug-info">Pitch: --</div>
        </div>
    </div>

    <!-- Logic -->
    <script src="js/app.js"></script>
    <script src="js/calibration.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>

</html>